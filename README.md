# hotels
Работа с основными операторами Spark SQL, фильтрация таблиц по разным условиям, написание вложенных запросы, объединение таблиц
## Содержание:
<li>
1. Создание таблицы, используя csv-файл с логами отеля
  Таблица logs_hotel:
  Поле	Описание
ID	Уникальный идентификатор брони
n_adults	Количество взрослых
n_children	Количество детей
weekend_nights	Количество забронированных ночей (суббота–воскресенье)
week_nights	Количество забронированных ночей (понедельник–пятница)
meal_plan	План питания
car_parking_space	Требуется ли парковка? (0 — нет, 1 — да)
room_type	Тип номера
lead_time	Количество дней между датой бронирования и датой прибытия
year	Год заселения
month	Месяц заселения
date	День заселения
market_segment	Тип бронирования (онлайн/оффлайн)
repeated_guest	Постоянный гость? (0 — нет, 1 — да)
previous_cancellations	Количество предыдущих заказов, которые были отменены клиентом до текущего бронирования
previous_bookings_not_canceled	Количество предыдущих заказов, не отмененных клиентом до текущего бронирования
avg_room_price	Средняя цена в день бронирования
special_requests	Общее количество специальных запросов, сделанных клиентом
status	Флаг, указывающий, было ли бронирование отменено или нет
</li>
<li>
  2. Создание таблицы calendar, состоящей из одного поля calendar_dt со всеми днями с 2017-01-01 по 2018-12-31
</li>
<li>
  Выполнение запросов:
  1) Вычислить среднее количество ночей, которые гости проводят в отеле (только для подтвержденных бронирований, с детализацией по месяцам и годам)
2) Определить ТОП-3 месяца по проценту отмененных броней за 2018 год.
3) Вычислить среднее время на каждый месяц между бронированием и заездом в отель для подтвержденных броней.
4) Вычислить общую среднюю выручку на каждый месяц в каждом году, сгруппировав по всем типам бронирования для подтвержденных броней, и вывести это в виде сводной таблицы (PIVOT).
5) Выявить ТОП-5 постоянных гостей, которые принесли наибольшую выручку за все время, и показать их долю в общей выручке от постоянных гостей. Использовать уникальный идентификатор брони как уникальный идентификатор гостя, предположив, что 1 бронь = 1 гость.
6) Вывести общее количество гостей на каждый день в отеле, отсортировав по убыванию дат, включая дни, когда отель пустует. Также рассчитать процент загрузки для каждого дня, если известно, что общая вместимость отеля 400 человек.
</li>
